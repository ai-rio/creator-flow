# Amazon Q Developer Rules for CreatorFlow

## Project Overview

CreatorFlow is a comprehensive TikTok Shop fulfillment automation platform designed to scale creators from 50 to 500+ orders per day without operational headaches. Built with Next.js 15, React, TypeScript, and Supabase.

**Target Users**: TikTok Shop sellers, e-commerce creators, scaling micro-brands
**Business Model**: Subscription-based SaaS ($49-$199/month) with usage-based pricing
**Status**: Production-ready MVP with active development roadmap

## Tech Stack

- **Framework**: Next.js 15 with App Router, React 19, TypeScript 5.7+
- **Database**: Supabase (PostgreSQL) with RLS, Edge Functions (Deno runtime)
- **Payments**: Stripe integration with webhooks and subscription management
- **UI**: Tailwind CSS, Radix UI, Shadcn/ui components, Lucide React icons
- **Testing**: Jest (unit), Playwright (E2E), Testing Library (React)
- **Analytics**: PostHog (product analytics), Vercel Analytics
- **Deployment**: Vercel/Fly.io with global CDN, Bun package manager

## Project Structure

```
creator-flow/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                 # Next.js App Router pages & API routes
â”‚   â”‚   â”œâ”€â”€ (auth)/         # Authentication pages
â”‚   â”‚   â”œâ”€â”€ (dashboard)/    # Main application pages
â”‚   â”‚   â”œâ”€â”€ api/            # API routes and webhooks
â”‚   â”‚   â””â”€â”€ globals.css     # Global styles
â”‚   â”œâ”€â”€ components/         # Reusable UI components (Shadcn/ui based)
â”‚   â”‚   â”œâ”€â”€ ui/            # Base shadcn/ui components
â”‚   â”‚   â””â”€â”€ custom/        # Custom application components
â”‚   â”œâ”€â”€ features/          # Feature-specific modules
â”‚   â”‚   â”œâ”€â”€ auth/          # Authentication logic
â”‚   â”‚   â”œâ”€â”€ orders/        # Order management
â”‚   â”‚   â”œâ”€â”€ shipping/      # Shipping integration
â”‚   â”‚   â”œâ”€â”€ analytics/     # Analytics and reporting
â”‚   â”‚   â””â”€â”€ tiktok/        # TikTok Shop integration
â”‚   â”œâ”€â”€ lib/               # Utilities, Supabase client, helpers
â”‚   â”‚   â”œâ”€â”€ supabase/      # Database client and helpers
â”‚   â”‚   â”œâ”€â”€ stripe/        # Payment processing
â”‚   â”‚   â”œâ”€â”€ tiktok/        # TikTok Shop API client
â”‚   â”‚   â””â”€â”€ utils/         # General utilities
â”‚   â””â”€â”€ types/             # TypeScript type definitions
â”œâ”€â”€ supabase/              # Database migrations, Edge Functions, config
â”œâ”€â”€ docs/                  # Comprehensive project documentation
â”œâ”€â”€ tests/                 # E2E tests and testing utilities
â””â”€â”€ scripts/               # Development, testing, and deployment scripts
```

## Core Technologies

- **Framework**: Next.js 15 with App Router, React 19, TypeScript 5.7+
- **Database**: Supabase (PostgreSQL) with RLS, Edge Functions
- **Payments**: Stripe integration with webhooks
- **UI**: Tailwind CSS, Radix UI, Shadcn/ui components
- **Testing**: Jest (unit), Playwright (E2E)
- **Analytics**: PostHog, Vercel Analytics
- **Package Manager**: Bun

## Development Standards

### Code Quality
1. **TypeScript First**: All code must be properly typed
2. **ESLint Compliance**: Follow project ESLint configuration
3. **Component Architecture**: Use Shadcn/ui patterns and Radix UI primitives
   - **See**: `src/components/CLAUDE.md` for component-specific guidelines
   - **MCP Integration**: Always use `mcp__shadcn-ui-v4__get_component` before UI work
   - Follow creator-focused UI patterns for TikTok Shop integration
4. **Error Handling**: Implement proper error boundaries and try-catch blocks
5. **Security First**: Never commit secrets, always use environment variables

### Code Style & Conventions

#### TypeScript Best Practices
- Use **ES modules** (import/export), not CommonJS (require)
- Destructure imports: `import { foo } from 'bar'`
- Prefer type assertions `(result as any)` for complex union types
- Use null assertions `session!.user.id` after proper null checks
- Add explicit type annotations for callback parameters:
  `orders.map((order: Order) => ...)`

#### UI Development Guidelines
- **MANDATORY**: Use **shadcn/ui components** as base building blocks
- Apply **CreatorFlow design system** patterns consistently
- **ALL interactive elements** must have proper accessibility
- Use **Tailwind CSS** with consistent design tokens
- Implement **responsive design** with mobile-first approach

#### Component Patterns
- Use **Shadcn/ui** components as foundation
- Implement **discriminated unions** for component variants
- Follow **composition patterns** with compound components
- Use **CVA (Class Variance Authority)** for variant management

#### Database Patterns
- Always use **RLS (Row Level Security)** for data access
- Include optional **relationship properties** in types:
  ```typescript
  interface Order {
    id: string;
    user_id: string;
    tiktok_order_id: string;
    // Relationships (optional for queries with joins)
    user?: {
      id: string;
      email: string;
    };
    items?: OrderItem[];
  }
  ```

### File Naming Conventions
- **Components**: PascalCase (`OrderList.tsx`)
- **Utilities**: camelCase (`formatOrderStatus.ts`)
- **API Routes**: lowercase with hyphens (`api/tiktok-orders/route.ts`)
- **Types**: PascalCase with descriptive names (`TikTokOrder.ts`)

### Error Handling Patterns
- Use **ActionResponse<T>** for consistent server action returns
- Implement proper **null checking** before object access
- Create **type guards** for union type disambiguation
- Log errors appropriately without exposing sensitive data

## Documentation Standards

1. **Follow Documentation Standards**: All docs follow [Project Documentation Standards](./docs/development/documentation-standards/DOCUMENTATION_STANDARDS.md)
2. **Four-category structure**: Use 00-planning/, 01-specifications/, 02-implementation/, 03-reports/
3. **Proper naming convention**: P###/S###/I###-DRAFT/R###-DRAFT format
4. **No root-level documentation**: All docs in appropriate `docs/` subdirectories
5. **DRAFT prefixes required**: Implementation and Report docs use DRAFT prefix until approved
6. **MoSCoW Methodology**: All documentation and feature planning must follow MoSCoW prioritization framework

## Business Context

- **Target Market**: TikTok Shop creators scaling from 50 to 500+ orders per day
- **Business Model**: $49-$199/month usage-based SaaS subscriptions
- **Revenue Target**: $10M ARR (8,333 customers Ã— $100 average MRR)
- **Value Proposition**: Eliminate operational bottlenecks for viral TikTok products

## **ðŸ¤– AI Agent Guidelines**

### **CRITICAL Documentation Rules for AI Agents**

1. **MANDATORY**: Follow [Project Documentation Standards](./docs/development/documentation-standards/DOCUMENTATION_STANDARDS.md) for ALL documentation
2. **NEVER** create documentation files in project root
3. **NEVER** claim implementation is "COMPLETE" without user validation
4. **ALWAYS** use four-category structure: 00-planning/, 01-specifications/, 02-implementation/, 03-reports/
5. **ALWAYS** use P###/S###/I###-DRAFT-/R###-DRAFT- naming convention
6. **ALWAYS** place docs in `docs/development/[initiative]/[category]/` structure

### **Prohibited Documentation Practices**

âŒ Creating `IMPLEMENTATION_COMPLETE.md` in root
âŒ Creating `PHASE_X_SUMMARY.md` without user approval
âŒ Claiming completion before user testing
âŒ Root-level status files
âŒ Final reports before validation

### **Required Documentation Practices**

âœ… `docs/development/[initiative]/02-implementation/I001-DRAFT-implementation-progress.md`
âœ… `docs/development/[initiative]/01-specifications/S001-technical-requirements.md`
âœ… `docs/development/[initiative]/00-planning/P001-investigation-findings.md`
âœ… Wait for user validation before removing `DRAFT-` prefix

### **Documentation Approval Flow**

1. **Start**: Create `DRAFT_` prefixed files in proper `docs/` location
2. **Progress**: Update drafts with implementation progress
3. **User Testing**: User validates functionality
4. **User Approval**: User explicitly approves completion
5. **Finalize**: Remove `DRAFT_` prefix only after user approval

## **CRITICAL Documentation Rules for AI Agents**

### **MANDATORY Documentation Rules**
1. **MANDATORY**: Follow [Project Documentation Standards](./docs/development/documentation-standards/DOCUMENTATION_STANDARDS.md) for ALL documentation
2. **NEVER** create documentation files in project root
3. **NEVER** claim implementation is "COMPLETE" without user validation
4. **ALWAYS** use four-category structure: 00-planning/, 01-specifications/, 02-implementation/, 03-reports/
5. **ALWAYS** use P###/S###/I###-DRAFT-/R###-DRAFT- naming convention
6. **ALWAYS** place docs in `docs/development/[initiative]/[category]/` structure

### **Prohibited Documentation Practices**

âŒ Creating `IMPLEMENTATION_COMPLETE.md` in root
âŒ Creating `PHASE_X_SUMMARY.md` without user approval
âŒ Claiming completion before user testing
âŒ Root-level status files
âŒ Final reports before validation

### **Required Documentation Practices**

âœ… `docs/development/[initiative]/02-implementation/I001-DRAFT-implementation-progress.md`
âœ… `docs/development/[initiative]/01-specifications/S001-technical-requirements.md`
âœ… `docs/development/[initiative]/00-planning/P001-investigation-findings.md`
âœ… Wait for user validation before removing `DRAFT-` prefix

## **MoSCoW Methodology Requirements**

**MANDATORY**: All feature planning and documentation MUST follow MoSCoW prioritization:

### **Must Have (M)** - Critical, Non-negotiable Requirements
- Core TikTok Shop order processing and fulfillment automation
- Secure webhook handling with signature verification
- Basic shipping label generation and tracking
- User authentication and data security (RLS policies)
- Payment processing and subscription management
- Mobile-responsive UI for creator dashboard

### **Should Have (S)** - Important, High-Priority Features  
- Advanced analytics and performance metrics
- Multi-carrier shipping integration
- Automated email notifications and alerts
- Inventory synchronization across platforms
- Customer support chat integration
- Advanced order filtering and search

### **Could Have (C)** - Nice-to-Have Features
- AI-powered order forecasting
- Advanced reporting and business intelligence
- Multi-language support for international creators
- Custom branding and white-label options
- Advanced workflow automation rules
- Third-party app integrations

### **Won't Have (W)** - Explicitly Out of Scope
- Full e-commerce platform functionality (shopping cart, checkout)
- Social media content creation tools
- Accounting and tax preparation features
- Customer service chatbots for end customers
- Physical product sourcing or manufacturing
- Competitor analysis tools

### **Documentation MoSCoW Application**
- **Planning documents**: Include MoSCoW breakdown for all features
- **Specifications**: Prioritize requirements using MoSCoW categories  
- **Implementation**: Focus on Must Have â†’ Should Have â†’ Could Have sequence
- **Reports**: Track completion by MoSCoW priority levels

## API Integration Priorities (MoSCoW)

### **Must Have (M)**: TikTok Shop Product, Order, Fulfillment, Authorization, Events APIs
### **Should Have (S)**: Return & Refund, Logistics, Financial APIs
### **Could Have (C)**: Promotion, Seller, Data Reconciliation APIs
### **Won't Have (W)**: Supply Chain API (enterprise features)

## **CreatorFlow-Specific Guidelines**

- **TikTok Shop Integration**: Always test webhook handling and API rate limits
- **Order Processing**: Ensure proper error handling for high-volume scenarios
- **Shipping Integration**: Test with multiple carriers and edge cases
- **Analytics**: Validate data accuracy and real-time updates
- **Security**: Implement proper webhook signature verification
- **MoSCoW Prioritization**: Apply to all feature development and documentation

## **Documentation Approval Flow**

1. **Start**: Create `DRAFT_` prefixed files in proper `docs/` location
2. **Progress**: Update drafts with implementation progress
3. **User Testing**: User validates functionality
4. **Approval**: User removes `DRAFT-` prefix after validation

## Testing Strategy

### Unit Tests (Jest)
- Focus on **business logic** and utility functions
- Mock external dependencies (Supabase, TikTok API, Stripe)
- Test **edge cases** and error scenarios
- Maintain **>80% coverage** for critical paths

### E2E Tests (Playwright)
- Test **complete user journeys** (auth, order processing, fulfillment)
- Validate **webhook handling** and real-time updates
- Test **high-volume scenarios** (500+ orders/day)

### Integration Testing
- Test **TikTok Shop webhook** handling
- Test **shipping API** integrations
- Test **Stripe webhook** processing
- Test **database operations** with real data

### Testing Rules
- **See**: `tests/Q_TESTING_RULES.md` for detailed testing guidelines
- **Mock Strategy**: Always mock external APIs in unit tests
- **Test Data**: Use factories for consistent test data generation
- **Assertions**: Prefer specific assertions over generic ones

## Essential Commands

### Development Workflow

```bash
# Start development (hot reload on :3000)
bun run dev

# Type checking (ALWAYS run after code changes)
bun run type-check

# Linting and formatting
bun run lint
bun run lint:fix

# Complete type safety check
bun run type-fix
```

### Database Operations

```bash
# Generate TypeScript types from Supabase schema
bun run generate-types

# Database migrations
bun run migration:new <name>
bun run migration:up

# Link to Supabase project
bun run supabase:link
```

### Testing Commands

```bash
# Unit tests
bun test

# End-to-end tests
bun run test:e2e
bun run test:e2e:ui          # Playwright UI mode

# Test specific features
bun run test:orders
bun run test:shipping
```

### Production & Deployment

```bash
# Production build
bun run build

# Bundle analysis
bun run analyze

# Security audit
bun run security:audit
```

## Environment Variables

```bash
# TikTok Shop API
TIKTOK_SHOP_APP_KEY=your_app_key_here
TIKTOK_SHOP_APP_SECRET=your_app_secret_here
TIKTOK_SHOP_WEBHOOK_SECRET=your_webhook_secret_here

# Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Stripe
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your_key
STRIPE_SECRET_KEY=sk_test_your_key
STRIPE_WEBHOOK_SECRET=whsec_your_secret

# Email & Analytics
RESEND_API_KEY=re_your_key
NEXT_PUBLIC_POSTHOG_KEY=your_posthog_key
```

## Quality Checklist

Before committing:

- [ ] `bun run type-check` passes
- [ ] `bun run lint` passes
- [ ] Critical tests pass: `bun test`
- [ ] **UI Components**: Used shadcn/ui components properly
- [ ] **Design System**: Applied CreatorFlow design tokens
- [ ] **Accessibility**: All interactive elements accessible
- [ ] **Mobile**: Tested on mobile devices
- [ ] No console.errors in development
- [ ] Environment variables documented
- [ ] Security considerations addressed

### Documentation Quality Gates

- [ ] **Follows Documentation Standards**: All docs follow project standards
- [ ] **Four-category structure**: Uses proper folder organization
- [ ] **Proper naming convention**: Follows P###/S###/I###/R### format
- [ ] **No root-level documentation**: All docs in appropriate subdirectories
- [ ] **No premature completion claims**: No "COMPLETE" files without validation
- [ ] **DRAFT prefixes required**: Implementation docs use DRAFT until approved

### TikTok Shop Integration Quality Gates

- [ ] **Webhook Verification**: Proper signature validation implemented
- [ ] **Rate Limiting**: Respects TikTok Shop API limits
- [ ] **Error Handling**: Graceful handling of API failures
- [ ] **Order Sync**: Bidirectional order status synchronization
- [ ] **Testing**: Comprehensive webhook and API testing

## Success Metrics

- **Order Processing**: 500+ orders/day capacity
- **Sync Latency**: <30 seconds for order sync
- **Uptime**: 99.9% API availability
- **Onboarding**: <2 minutes creator setup time
- **TypeScript Errors**: 0 compilation errors maintained

## Learning Resources

- [Next.js 15 App Router Docs](https://nextjs.org/docs)
- [Supabase Documentation](https://supabase.com/docs)
- [TikTok Shop API Documentation](https://partner.tiktokshop.com/docv2/page/6507ead7b99d5302be949ba9)
- [Tailwind CSS Docs](https://tailwindcss.com/docs)
- [Shadcn/ui Components](https://ui.shadcn.com)

## Documentation & Development Resources (MANDATORY READING)

- **[Project Documentation Standards](./docs/development/documentation-standards/DOCUMENTATION_STANDARDS.md)** - Official documentation organization standard
- [Development Guide](./docs/development/README.md) - Complete development setup
- [Architecture Overview](./docs/architecture/README.md) - System architecture and design
- [Features Overview](./docs/features/README.md) - Feature specifications and roadmap
- [Business Overview](./docs/business/README.md) - Business model and strategy

---

*This file guides Amazon Q Developer to maintain CreatorFlow's standards and business objectives while ensuring scalable, maintainable code that serves TikTok Shop creators effectively.*